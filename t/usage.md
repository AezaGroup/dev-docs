# Использование API и авторизация

Для общения с API используется базовый URL:
```https://core.aeza.net/api```
Если мы хотим получить список продуктов, то есть использовать роут ```services/products```, то отправим GET запрос по адресу ```https://core.aeza.net/api/services/products```. Пример команды curl:
```curl https://core.aeza.net/api/services/products```.

Данные всегда возвращаются в формате JSON, если API метод подразумевает получение списка сущностей, то данные возвращаются в формате:
| Поле | Значение |
|------------------------------------------------------|--------------------------------|
| items | массив объектов |
| total | количество всех объектов |
| edit | описание формата для редактирования |

Для вызова метода, требующего авторизации нужно передавать заголовок ```Authorization: Bearer ТОКЕН```, токен нужно получить с помощью:
```POST auth```, куда передается ```{
"method": "credentials",
"email": "sample@domain.domain",
"password": "myC0ldPa22word"
}```

Вместо credentials можно использовать другие поддерживаемые методы авторизации (в разработке).

Если данные введены верно, то вернется объект с полями *session* и *expiresAt*. Первый будет являться токеном для последующих API запросов.

## Обновление сессии
Токен имеет свой срок жизни в 24 часа. Чтобы обновить его, нужно вызвать ```PUT auth```, метод вернет новый api токен для запросов, а предыдущий ключ станет неактивен.

## Дополнительные GET параметры
API биллинга поддерживает следующие GET параметры:
| Поле | Описание | Варианты | Стандартное значение |
|------------------------------------------------------|--------------------------------| --- | --- |
| lang | язык локализации | en, ru | Как в настройках |
| extra | вернет расширенную информацию при получении списка объектов | 1 | 0 или 1 при получении конкретных сущностей |
| current | вернет текущую активную сущность (для сессий вернет текущую сессию) | 1 | 0 |
| edit | вернет поле edit с описанием полей для редактирования | 1 | 0 или 1 при PUT/POST запросах |
| sort | порядок сортировки сущностей | перечисление ключей через запятую. По стандарту сортирует по возрастанию, если требуется сортировать по убыванию, то перед ключем вводится ~. Пример: "id,~balance" | - |
| offset | отступ | integer | 0 |
| count | лимит возвращаемых сущностей | integer | 100 |

## Преобразование валют
В настройках можно выбрать отображение цен в другой валюте. На стороне сервера и API все цены рассчитаны в стандартной валюте, в рублях. Для отображения в другой валюте они перемножаются на текущий курс данной валюты по отношению к главной.

Чтобы получить список множителей нужно отправить запрос ```GET payment/currencies```. Для преобразования средств в другую валюту используется формула: ```ceil(value * multiplier * R) / R```, где R, это ```10 ** round```, value - средства в изначальном виде, multiplier - множитель валюты, round - количество знаков после запятой для округления валюты.
